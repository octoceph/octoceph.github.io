
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard ‚Äî GitHub Pages + MAX auth (demo)</title>
  <meta name="description" content="–ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è GitHub Pages —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ª–µ–≤—ã–º –º–µ–Ω—é –∏ –≤—Ö–æ–¥–æ–º —á–µ—Ä–µ–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä MAX (–¥–µ–º–æ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)">
  <style>
    :root{--sidebar-w:260px;--accent:#0f62fe;--bg:#f5f7fb}
    *{box-sizing:border-box}
    html,body,#app{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}

    /* SIDEBAR */
    .sidebar{position:fixed;left:0;top:0;bottom:0;width:var(--sidebar-w);background:#fff;border-right:1px solid #e6e9ef;padding:18px 16px;display:flex;flex-direction:column;gap:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;background:linear-gradient(135deg,var(--accent),#7b61ff);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .app-title{font-weight:700}
    nav{flex:1}
    .nav-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;color:#2b3440;text-decoration:none}
    .nav-item:hover{background:#f0f4ff;color:var(--accent);cursor:pointer}
    .nav-item.active{background:#eef6ff;color:var(--accent);font-weight:600}
    .sidebar-footer{font-size:13px;color:#667085}

    /* MAIN */
    .main{margin-left:var(--sidebar-w);padding:24px}
    .top{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .search{flex:1;max-width:420px}
    .card-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:18px}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 1px 2px rgba(16,24,40,0.04);border:1px solid #eef2ff}
    .table{margin-top:18px;background:#fff;padding:12px;border-radius:12px;border:1px solid #eef2ff}

    /* Responsive */
    @media (max-width:900px){:root{--sidebar-w:76px}.sidebar{width:76px;padding:12px}.app-title,.sidebar-footer{display:none}.main{margin-left:76px}.card-grid{grid-template-columns:repeat(1,1fr)}}

    /* Login badge */
    .user-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0f1724;color:#fff}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #e6e9ef;color:#111}
  </style>
</head>
<body>
<div id="app">
  <aside class="sidebar" role="navigation" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
    <div class="brand">
      <div class="logo">OC</div>
      <div>
        <div class="app-title">OctoCore</div>
        <div style="font-size:12px;color:#667085">GitHub Pages demo</div>
      </div>
    </div>

    <nav>
      <a class="nav-item active" data-view="dashboard">üìä –ü–∞–Ω–µ–ª—å</a>
      <a class="nav-item" data-view="reports">üìÅ –û—Ç—á—ë—Ç—ã</a>
      <a class="nav-item" data-view="users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
      <a class="nav-item" data-view="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
    </nav>

    <div>
      <div style="margin-bottom:10px">
        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ MAX -->
        <button id="max-login" class="btn" aria-label="–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ MAX">üîê –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ MAX</button>
        <button id="demo-login" class="btn ghost" style="margin-left:8px">üë§ –î–µ–º–æ</button>
      </div>
      <div class="sidebar-footer">–í–µ—Ä—Å–∏—è demo ‚Ä¢ –°—Ç–∞—Ç—É—Å: <strong id="auth-status">–Ω–µ –≤ —Å–∏—Å—Ç–µ–º–µ</strong></div>
    </div>
  </aside>

  <main class="main" role="main">
    <div class="top">
      <h1 id="view-title">–ü–∞–Ω–µ–ª—å</h1>
      <div style="display:flex;gap:12px;align-items:center">
        <input class="search" type="search" placeholder="–ü–æ–∏—Å–∫..." aria-label="–ü–æ–∏—Å–∫">
        <div id="user-area"></div>
      </div>
    </div>

    <div class="card-grid">
      <div class="card"><h3>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å 1</h3><p id="metric-1">‚Äî</p></div>
      <div class="card"><h3>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å 2</h3><p id="metric-2">‚Äî</p></div>
      <div class="card"><h3>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å 3</h3><p id="metric-3">‚Äî</p></div>
    </div>

    <div class="table">
      <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
      <table style="width:100%;border-collapse:collapse">
        <thead style="text-align:left;color:#6b7280;font-size:13px"><tr><th>–í—Ä–µ–º—è</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr></thead>
        <tbody id="events-body">
          <tr><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td></tr>
        </tbody>
      </table>
    </div>

    <section style="margin-top:18px;color:#475569;font-size:13px">
      <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å MAX</strong>
      <ol>
        <li>MAX –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <em>Bot API / SDK</em> –∏ (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö) OAuth-–ø–æ–¥–æ–±–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –î–ª—è production-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ <code>authorization_code</code> –Ω–∞ —Ç–æ–∫–µ–Ω.</li>
        <li>GitHub Pages ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥: —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –æ–±–º–µ–Ω –∫–æ–¥–æ–≤ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ serverless-—Ñ—É–Ω–∫—Ü–∏–∏ (Vercel, Netlify Functions, Cloud Functions) –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π API.</li>
        <li>–í –¥–µ–º–æ-–∫–Ω–æ–ø–∫–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ <em>–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è</em> –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å OAuth-popup –∏ —Å—á–∏—Ç–∞—Ç—å –∫–æ–¥, –∞ —Ç–∞–∫–∂–µ "–¥–µ–º–æ-–≤—Ö–æ–¥", –∫–æ—Ç–æ—Ä—ã–π —ç–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞).</li>
      </ol>
    </section>
  </main>
</div>

<script>
/* ---------------------------------------------------------
   –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   –ï—Å–ª–∏ MAX –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç OAuth-–ø–æ–¥–¥–µ—Ä–∂–∫—É, —É–∫–∞–∂–∏—Ç–µ AUTH_ENDPOINT
   –∏ CLIENT_ID. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ flow —á–µ—Ä–µ–∑ –±–æ—Ç–∞ + webhook
   (–¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å webhooks).
   ---------------------------------------------------------*/
const CONFIG = {
  // –ü—Ä–∏–º–µ—Ä: "https://max.ru/oauth/authorize"
  MAX_AUTH_ENDPOINT: 'https://MAX_AUTH_ENDPOINT_HERE',
  CLIENT_ID: 'YOUR_MAX_CLIENT_ID',
  REDIRECT_URI: location.origin + location.pathname, // GitHub Pages URL
  SCOPES: 'openid profile',
}

// –£—Ç–∏–ª–∏—Ç—ã
function qs(name){return new URLSearchParams(location.search).get(name)}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
document.querySelectorAll('.nav-item').forEach(el=>el.addEventListener('click', ()=>{
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('view-title').innerText = el.dataset.view[0].toUpperCase() + el.dataset.view.slice(1);
}))

// AUTH: –æ—Ç–∫—Ä—ã–≤–∞–µ–º popup –∏ –∂–¥—ë–º —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ –Ω–∞—à REDIRECT_URI
function openMaxOAuth(){
  if(CONFIG.MAX_AUTH_ENDPOINT.includes('MAX_AUTH_ENDPOINT')){
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ CONFIG.MAX_AUTH_ENDPOINT –∏ CLIENT_ID –≤ –∫–æ–¥–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OAuth.\n\n–î–ª—è –¥–µ–º–æ –Ω–∞–∂–º–∏—Ç–µ "–î–µ–º–æ".');
    return;
  }
  const state = Math.random().toString(36).slice(2);
  sessionStorage.setItem('max_oauth_state', state);
  const authUrl = `${CONFIG.MAX_AUTH_ENDPOINT}?response_type=code&client_id=${encodeURIComponent(CONFIG.CLIENT_ID)}&redirect_uri=${encodeURIComponent(CONFIG.REDIRECT_URI)}&scope=${encodeURIComponent(CONFIG.SCOPES)}&state=${encodeURIComponent(state)}`;
  const popup = window.open(authUrl,'_blank','width=500,height=700');

  // poll the popup until it redirects back to our origin
  const poll = setInterval(()=>{
    try{
      if(!popup || popup.closed){ clearInterval(poll); return }
      // –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–∏—Ç–∞—Ç—å popup.location —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–∞ —Ç–æ–º –∂–µ origin
      if(popup.location.origin === location.origin){
        const params = new URLSearchParams(popup.location.search);
        const code = params.get('code');
        const gotState = params.get('state');
        if(code){
          popup.close();
          clearInterval(poll);
          handleAuthCode(code, gotState);
        }
      }
    }catch(e){
      // cross-origin –ø–æ–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ
    }
  },500);
}

function handleAuthCode(code, gotState){
  const expected = sessionStorage.getItem('max_oauth_state');
  if(!expected || expected !== gotState){
    alert('State –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞—è CSRF-–∞—Ç–∞–∫–∞. –ü—Ä–µ–∫—Ä–∞—â–∞—é.');
    return;
  }
  // –í–ê–ñ–ù–û: –æ–±–º–µ–Ω code -> token –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!
  // –ù–∏–∂–µ ‚Äî —Ç–æ–ª—å–∫–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–º –∫–æ–¥ –≤ localStorage –∏ –æ—Ç–º–µ—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –≤–æ—à–µ–¥—à–µ–≥–æ.
  localStorage.setItem('max_demo_code', code);
  setLoggedIn({name:'MAX user', id:'demo-'+code.slice(0,6), token:'demo-token-123'});
  // –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å serverless-—ç–Ω–¥–ø–æ–∏–Ω—Ç, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å fetch —Å—é–¥–∞:
  // fetch('/.netlify/functions/exchange', {method:'POST', body: JSON.stringify({code})})
}

function setLoggedIn(user){
  document.getElementById('auth-status').innerText = '–≤ —Å–∏—Å—Ç–µ–º–µ';
  document.getElementById('user-area').innerHTML = `<div class=\"user-pill\">üë§ ${escapeHtml(user.name)} <button id=\"logout\" style=\"margin-left:8px;border:0;background:transparent;color:#fff;cursor:pointer\">‚éã</button></div>`;
  document.getElementById('metric-1').innerText = '42';
  document.getElementById('metric-2').innerText = '128';
  document.getElementById('metric-3').innerText = '7.4%';
  const tbody = document.getElementById('events-body');
  tbody.innerHTML = `<tr><td>${new Date().toLocaleString()}</td><td>${escapeHtml(user.name)}</td><td>–í–æ—à—ë–ª —á–µ—Ä–µ–∑ MAX</td></tr>`;
  document.getElementById('logout').addEventListener('click', ()=>{ localStorage.removeItem('max_demo_code'); location.reload() });
}

function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]))}

// Demo login (–∫–Ω–æ–ø–∫–∞ –±–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
document.getElementById('demo-login').addEventListener('click', ()=>{
  setLoggedIn({name:'–î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', id:'demo-1', token:'demo-token'});
});

// –†–µ–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ OAuth
document.getElementById('max-login').addEventListener('click', ()=>{
  openMaxOAuth();
});

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî –µ—Å–ª–∏ –≤ URL –µ—Å—Ç—å ?code=... –∏ state=..., –æ–±—Ä–∞–±–æ—Ç–∞–µ–º (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –±–µ–∑ popup)
window.addEventListener('load', ()=>{
  const code = qs('code'); const state = qs('state');
  if(code){
    // –û—á–∏—Å—Ç–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∏
    history.replaceState({}, document.title, location.pathname);
    handleAuthCode(code, state);
  }
});
</script>
</body>
</html>
